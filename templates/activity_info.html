{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ activity.name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <style>
        /* CSS ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            text-align: center;
        }

        .container {
            max-width: 600px;
            margin: 50px auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
        }

        p {
            font-size: 18px;
            color: #555;
        }

        .btn {
            display: inline-block;
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            margin-top: 10px;
        }

        .btn:hover {
            background-color: #45a049;
        }

        /* ‡πÄ‡∏û‡∏¥‡πà‡∏° CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö navbar */
        .navbar {
            background-color: lightskyblue;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            box-shadow: 0 4px 8px lightblue;
        }

        .left-side {
            position: relative;
        }

        .menu {
            font-size: 18px;
            color: #fff;
            text-decoration: none;
            font-weight: bold;
            padding: 8px 12px;
            background-color: #4CAF50;
            border-radius: 5px;
            cursor: pointer;
            display: inline-block;
        }

        .menu:hover {
            background-color: #2980b9;
        }

        .dropdown {
            display: none;
            position: absolute;
            top: 40px;
            left: 0;
            background-color: white;
            min-width: 200px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            overflow: hidden;
            z-index: 100;
        }

        .dropdown a {
            display: block;
            padding: 12px;
            text-decoration: none;
            color: #333;
            font-size: 14px;
            transition: background 0.3s ease;
        }

        .dropdown a:hover {
            background-color: #f1f1f1;
        }

        .menu-container.active .dropdown {
            display: block;
        }

        .right-side {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .right-side span {
            font-size: 16px;
            color: #fff;
            font-weight: bold;
        }

        .right-side a {
            color: #fff;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 5px;
            background-color: #4CAF50;
            transition: background-color 0.3s ease;
        }

        .right-side a:hover {
            background-color: #45a049;
        }

        .logout-btn {
            background-color: red;
            color: white;
            border: none;
            padding: 8px 15px;
            cursor: pointer;
            border-radius: 5px;
        }

        .logout-btn:hover {
            background-color: darkred;
        }
    </style>
</head>
<body>
  <!-- Navbar -->
<div class="navbar">
    <div class="left-side">
        <div class="menu-container" style="display: flex; align-items: center; gap: 10px;">
          <a href="#" class="menu">Menu</a>
          
          <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å -->
          <a href="{% url 'home' %}" class="menu">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
          
          <div class="dropdown">
            <a href="{% url 'track_participation' %}">üìä ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</a>
            <a href="{% url 'upload_proof' %}">üìé ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</a>
          </div>
        </div>
    </div>
  
    <div class="right-side">
      {% if user.is_authenticated %}
        <span>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö, {{ user.username }}</span>
        <form method="post" action="{% url 'logout' %}" style="display:inline;">
          {% csrf_token %}
          <button type="submit" class="logout-btn">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </form>      
      {% else %}
        <a href="{% url 'login' %}">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
        <a href="{% url 'register' %}">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</a>
      {% endif %}
    </div>
  </div>

  <div class="container">
    <h1>{{ activity.name }}</h1>

    {% if activity.images.all %}
        <div class="activity-images">
            {% for image in activity.images.all %}
                <img src="{{ image.image.url }}" alt="‡∏£‡∏π‡∏õ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°" style="width: 100%; border-radius: 5px;">
            {% endfor %}
        </div>
    {% else %}
        <p style="color: red;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</p>
    {% endif %}

    <p><strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</strong> {{ activity.description }}</p>
    <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°:</strong> {{ activity.start_date }}</p>
    <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î:</strong> {{ activity.end_date }}</p>

    <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° -->
    <form method="post" action="{% url 'join_activity' activity.id %}" style="margin-top: 10px;">
        {% csrf_token %}
        <button type="submit" class="btn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</button>
    </form>
    <button onclick="fetchParticipants({{ activity.id }})">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</button>
  </div>

    <div id="participantModal" style="display:none; position:fixed; top:20%; left:50%; transform:translate(-50%, 0); padding:20px; background:white; border:1px solid #ccc;">
        <h3>‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</h3>
        <ul id="participantList"></ul>
        <button onclick="closeModal()">‡∏õ‡∏¥‡∏î</button>
    </div>


  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const menuContainer = document.querySelector(".menu-container");
      const menuButton = document.querySelector(".menu");
      const dropdown = menuContainer.querySelector(".dropdown");
  
      // ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î dropdown ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏° Menu
      menuButton.addEventListener("click", function (event) {
          event.stopPropagation(); // ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå
          menuContainer.classList.toggle("active");
      });
  
      // ‡∏õ‡∏¥‡∏î dropdown ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏∑‡πà‡∏ô
      document.addEventListener("click", function () {
          menuContainer.classList.remove("active");
      });
  
      // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô dropdown ‡∏õ‡∏¥‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô
      dropdown.addEventListener("click", function (event) {
          event.stopPropagation(); // ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå
      });
    });

    
    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤
    function fetchParticipants(activityId) {
        fetch(`/participants/${activityId}/`)
            .then(response => response.json())
            .then(data => {
                const list = document.getElementById('participantList');
                list.innerHTML = "";
                data.participants.forEach(student => {
                    let li = document.createElement("li");
                    li.textContent = `${student.full_name} - ‡∏õ‡∏µ ${student.year}, ${student.branch}`;
                    list.appendChild(li);
                });
                document.getElementById("participantModal").style.display = "block";
            })
            .catch(error => console.error("Error fetching participants:", error));
    }

    function closeModal() {
        document.getElementById("participantModal").style.display = "none";
    }
  </script>
</body>
</html>